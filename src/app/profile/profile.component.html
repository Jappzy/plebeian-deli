<button
    *ngIf="editable"
    mat-raised-button
    class="widescreen-edit-button"
    routerLink="/edit-profile">
    <mat-icon>edit</mat-icon>
    <span style="margin-left: 10px">Edit Profile</span>
</button>

<br>

<ng-container *ngIf="user$ | async as user">
<div class="cont">

    <div class="left-column" [ngClass]="editing ? 'left-column-editing' : ''">
        
        <div class="header-section-1">
        
            <!-- Profile Pic-->
            <div
                *ngIf="user.mediumThumbnail | async as thumbnail"
                class="profile-pic"
                [ngStyle]="{'background': thumbnail?.length ? 'url(' + thumbnail + ')' : 'linear-gradient(#80caa2, #add87d)'}"
                [ngClass]="thumbnail ? 'bg' : ''">
                <ng-container *ngIf="editable">
                    <label for="profile-pic-upload" class="upload-btn">
                        <mat-icon>publish</mat-icon>
                        <span style="margin-left: 10px">Upload</span>
                    </label>
                    <input
                        id="profile-pic-upload"
                        type="file"
                        accept="image/*"
                        style="display: none"
                        (change)="uploadProfilePic($event)">
                </ng-container>
            </div>

            <!-- Real Name -->
            <p>{{ user.displayName || user.username }}</p>

            <!-- Location -->
            <p>{{ user.location }}</p>

        </div>

        <div class="header-section-2">

            <!-- message -->
            <button
                *ngIf="!editable"
                mat-raised-button
                style="margin-bottom: 1em"
                (click)="initiateChat(user)">
                Send Message
            </button>

            <!-- Social Links -->
            <div>
                <button *ngIf="user.instagram" mat-button (click)="openInstagram(user.instagram)">
                    <mat-icon svgIcon="instagram"></mat-icon>
                    <span class="social-text">{{ user.instagram }}</span>
                </button>

                <button *ngIf="user.facebook" mat-button (click)="openFacebook(user.facebook)">
                    <mat-icon svgIcon="facebook"></mat-icon>
                    <span class="social-text">Facebook</span>
                </button>

                <button *ngIf="user.otherLink" mat-button (click)="openOtherLink(user.otherLink)">
                    <mat-icon>link</mat-icon>
                    <span class="social-text">Website</span>
                </button>
            </div>

            <!-- CV -->
            <ng-container *ngIf="user.membership === 'artist' && editable && editing; else viewCV">
                <button *ngIf="user.cv" mat-button style="padding: 0">
                    <a href="{{ user.cv }}" target="_blank" style="text-decoration: none; padding: 0 1em;">View CV</a>
                </button>
                <button mat-button style="padding: 0">
                    <label for="cv-upload" class="cv-upload-btn">
                        <mat-icon>publish</mat-icon>
                        <span style="margin-left: 10px">Upload New CV</span>
                    </label>
                </button>
                <input
                    id="cv-upload"
                    type="file"
                    accept="application/pdf"
                    style="display: none"
                    (change)="uploadCv($event)">
            </ng-container>
    
            <ng-template #viewCV>
                <button *ngIf="user.membership === 'artist' && user.cv" mat-button style="padding: 0">
                    <a href="{{ user.cv }}" target="_blank" style="text-decoration: none; padding: 0 1em;">View CV</a>
                </button>
            </ng-template>

            <!-- Galleries -->
            <ng-container *ngIf="user.membership === 'artist'">
                <ng-container *ngIf="galleries$ | async as galleries">
                    <p *ngIf="galleries.length">Galleries</p>
                    <button
                        mat-button
                        *ngFor="let gallery of galleries"
                        [routerLink]="'/' + gallery.username"
                        style="display: block">
                        {{ gallery.username }}
                    </button>
                </ng-container>
            </ng-container>

        </div>

    </div>

    <div class="right-column">

        <!-- Username and Medium/Membership -->
        <div *ngIf="!editing" class="name-and-medium">
            <h1 style="font-weight: 200">{{ user.username }}</h1>
            <h1 *ngIf="user.membership === 'viewer'" style="font-weight: 200">{{ 'Member' }}</h1>
            <h1 *ngIf="user.membership === 'artist' && user.medium" style="font-weight: 200">{{ user.medium | titlecase }}</h1>
            <h1 *ngIf="user.membership === 'artist' && !user.medium" style="font-weight: 200">Artist</h1>
            <h1 *ngIf="user.membership === 'gallery'" style="font-weight: 200">{{ 'Gallery' }}</h1>
        </div>


        <!-- Bio/Description -->
        <div style="width: 95%; margin: 1em auto; display: block;">{{ user.bio || user.description || '' }}</div>


        <br><br>

        <!-- ProfileBackgroundUrl -->
        <div
            *ngIf="editable && editing"
            class="profile-background-pic">
            <ng-container *ngIf="editable">
                <label for="background-pic-upload" class="upload-btn" style="border-radius: 10px; opacity: 0.95;">
                    <mat-icon>publish</mat-icon>
                    <span style="margin-left: 10px">{{ user.backgroundUrl ? 'Change Background Image' : 'Upload Background Image' }}</span>
                </label>
                <input
                    id="background-pic-upload"
                    type="file"
                    accept="image/*"
                    style="display: none"
                    (change)="uploadBackgroundPic($event)">
            </ng-container>
        </div>

        <ng-container *ngIf="user.backgroundThumbnail | async as bg">
            <img
                *ngIf="bg.length"
                [src]="bg"
                alt="Background Image"
                style="max-height: 500px; max-width: 95%; margin: 0 auto; display: block;">
        </ng-container>

        <br>

        <!-- Services -->
        <!-- <app-services
            *ngIf="user.membership === 'artist' && user.approvedSeller"
            [user]="user"
            [editable]="editable">
        </app-services> -->
        <div style="margin: 1em; display: flex; justify-content: space-between; align-items: center;">
            <h2>Services</h2>
            <button *ngIf="editable" mat-raised-button color="accent" routerLink="/new-service">
                <mat-icon>add</mat-icon>
            </button>
        </div>
        <div class="services-container">
            <mat-card *ngFor="let service of services$ | async" class="service-card">
                <button
                    *ngIf="editable"
                    mat-button
                    [matMenuTriggerFor]="actions"
                    style="float: right"
                    (click)="$event.stopPropagation()">
                    <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #actions="matMenu">
                    <button mat-menu-item>
                        <mat-icon>edit</mat-icon>
                        <span style="margin-left: 5px">Edit</span>
                    </button>
                    <button mat-menu-item color="warn" (click)="serviceService.deleteService(service.serviceId)">
                        <mat-icon color="warn">delete</mat-icon>
                        <span style="margin-left: 5px; color: #f44336;">Delete</span>
                    </button>
                </mat-menu>
                <p>{{ service.title }}</p>
            </mat-card>
        </div>

        <br>

        <!-- Events -->
        <app-events
            *ngIf="user.membership === 'gallery'"
            [user]="user"
            [editable]="editable">
        </app-events>

        <br>

        <!-- Artists -->
        <app-artists
            *ngIf="user.membership === 'gallery'"
            [user]="user"
            [editable]="editable">
        </app-artists>

    </div>

</div>

<!-- Posts -->
<app-posts
    *ngIf="user.membership === 'artist'"
    [user]="user"
    [editable]="editable"
    [categories]="categories">
</app-posts>

</ng-container>

<div style="height: 100px"></div>


<app-footer></app-footer>
